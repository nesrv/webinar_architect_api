# Практический пример JSON-RPC API: Умный дом

В этом примере мы создадим JSON-RPC API для управления системой умного дома. Наша система будет имитировать управление различными устройствами: освещением, термостатом, телевизором и дверным замком.

## Особенности примера

- **Реалистичный сценарий использования** - управление устройствами умного дома
- **Несколько типов устройств** с разными параметрами
- **Сценарии** для автоматизации нескольких устройств одновременно
- **Имитация датчиков** с динамически меняющимися значениями
- **Консольный клиент** для удобного тестирования API

## Структура проекта

- `smart_home_api.py` - сервер JSON-RPC API
- `smart_home_client.py` - консольный клиент для взаимодействия с API

## Запуск примера

1. Установите необходимые библиотеки:
   ```bash
   pip install aiohttp jsonrpcserver requests
   ```

2. Запустите сервер:
   ```bash
   python smart_home_api.py
   ```

3. В другом терминале запустите клиент:
   ```bash
   python smart_home_client.py
   ```

## Доступные методы API

### Управление устройствами

- **get_all_devices** - получить список всех устройств и их статусы
- **get_device_status** - получить статус конкретного устройства
- **set_device_status** - включить/выключить устройство
- **set_light_brightness** - установить яркость освещения (0-100%)
- **set_temperature** - установить целевую температуру термостата

### Сценарии

- **activate_scene** - активировать предустановленный сценарий:
  - `movie_night` - настройка для просмотра фильма
  - `cooking` - настройка для приготовления пищи
  - `away` - режим "Никого нет дома"

### Датчики

- **get_sensors_data** - получить текущие показания датчиков (температура, влажность, движение)

## Примеры запросов

### Получение списка всех устройств

```json
{
  "jsonrpc": "2.0",
  "method": "get_all_devices",
  "params": {},
  "id": 1
}
```

### Включение света в гостиной

```json
{
  "jsonrpc": "2.0",
  "method": "set_device_status",
  "params": {
    "device_id": "light_living_room",
    "status": "on"
  },
  "id": 1
}
```

### Установка яркости света

```json
{
  "jsonrpc": "2.0",
  "method": "set_light_brightness",
  "params": {
    "device_id": "light_living_room",
    "brightness": 50
  },
  "id": 1
}
```

### Активация сценария "Просмотр фильма"

```json
{
  "jsonrpc": "2.0",
  "method": "activate_scene",
  "params": {
    "scene_id": "movie_night"
  },
  "id": 1
}
```

## Преимущества использования JSON-RPC для IoT

1. **Простота интеграции** - единый эндпоинт для всех операций
2. **Легкость добавления новых методов** без изменения структуры API
3. **Компактность запросов** - меньше накладных расходов по сравнению с REST
4. **Поддержка пакетных запросов** - можно отправить несколько команд за один запрос
5. **Удобство для IoT устройств** с ограниченными ресурсами

## Возможные улучшения

- Добавление аутентификации и авторизации
- Поддержка WebSockets для получения уведомлений в реальном времени
- Добавление истории состояний устройств
- Расширение списка устройств и их возможностей
- Интеграция с реальными устройствами через соответствующие протоколы