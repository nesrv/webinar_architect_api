### **Event-based (—Å–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ API**

**–§–æ—Ä–º–∞—Ç:** –¢–µ–æ—Ä–∏—è + –ü—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞ Python (FastAPI + WebSockets + Redis)

---

## **1. –í–≤–µ–¥–µ–Ω–∏–µ**

![alt text](img/WebSockets.gif)

### Event-based (—Å–æ–±—ã—Ç–∏–π–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ API

**Event-based API** ‚Äì —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ –∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –≥–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏—è–º–∏, –∞ –Ω–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏. –í–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–ª–∏ —è–≤–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è (–∫–∞–∫ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∏–ª–∏ callback-based –ø–æ–¥—Ö–æ–¥–µ) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Å–∏—Å—Ç–µ–º–æ–π –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

### üîπ **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å** ‚Äì –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞.
2. **–†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** ‚Äì –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–ª–∏–∫, HTTP-–∑–∞–ø—Ä–æ—Å, —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏).
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —è–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤** ‚Äì —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Ü–∏–∫–ª—É —Å–æ–±—ã—Ç–∏–π (event loop), –∞ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤.
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äì —Ö–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è I/O-–∑–∞–¥–∞—á (—Å–µ—Ç–∏, —Ñ–∞–π–ª—ã, –ë–î).

### üîπ **–ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ API**

- **–í–µ–±/Frontend**:
  - `EventTarget` –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö (`addEventListener`).
  - WebSockets (`onmessage`, `onopen`).
  - `fetch` + `Promise` (–Ω–æ –º–æ–∂–Ω–æ –æ–±–µ—Ä–Ω—É—Ç—å –≤ —Å–æ–±—ã—Ç–∏—è).
- **Backend/–°–µ—Ä–≤–µ—Ä–Ω—ã–µ API**:
  - Node.js (`EventEmitter`, `stream`, `http.Server`).
  - RabbitMQ, Kafka (–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ —Å–æ–±—ã—Ç–∏–π).
  - Webhooks (HTTP-–∫–æ–ª–±—ç–∫–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤).
- **–î—Ä—É–≥–∏–µ**:
  - GUI-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (Qt, GTK).
  - IoT (MQTT-–±—Ä–æ–∫–µ—Ä—ã).

### üîπ **–ü—Ä–∏–º–µ—Ä –Ω–∞ Node.js (EventEmitter)**

```javascript
const EventEmitter = require('events');

class MyEmitter extends EventEmitter {}

const myEmitter = new MyEmitter();

// –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
myEmitter.on('event', (data) => {
  console.log('–°–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ!', data);
});

// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ
myEmitter.emit('event', { id: 1, message: 'Hello' });
```

### üîπ **–ü–ª—é—Å—ã**

‚úî –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è I/O-bound –∑–∞–¥–∞—á.
‚úî –õ—É—á—à–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, —á–µ–º —É –ø–æ—Ç–æ–∫–æ–≤.
‚úî –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (–ø–æ–¥–ø–∏—Å–∫–∞/–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π).

### üîπ **–ú–∏–Ω—É—Å—ã**

‚ùå –°–ª–æ–∂–Ω–µ–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å (–ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ–ª–∏–Ω–µ–π–Ω—ã–π).
‚ùå –í–æ–∑–º–æ–∂–Ω—ã "—É—Ç–µ—á–∫–∏" —Å–ª—É—à–∞—Ç–µ–ª–µ–π (memory leaks, –µ—Å–ª–∏ –Ω–µ –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è).
‚ùå Callback hell (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Promise`/`async-await`).

Event-based API –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –æ—à–∏–±–∫–∞–º–∏. –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —á–∞—Å—Ç–æ –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç—Å—è —Å `Promise` –∏ `async-await`.

### **1.1 –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–π–Ω—ã–µ API?**

- **Event-based API** —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (—Å–æ–æ–±—â–µ–Ω–∏—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö).
- **–û—Ç–ª–∏—á–∏–µ –æ—Ç REST:**
  - REST: –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã ("—Ç—è–Ω–µ—Ç" –¥–∞–Ω–Ω—ã–µ).
  - Event-based: —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö ("—Ç–æ–ª–∫–∞–µ—Ç" –¥–∞–Ω–Ω—ã–µ).

### **1.2 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è —Å–æ–±—ã—Ç–∏–π–Ω—ã—Ö API**

| **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**           | **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**                                             |
| ---------------------------------------- | -------------------------------------------------------------------------------- |
| **WebSockets**                     | –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |
| **Server-Sent Events (SSE)**       | –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø–æ—Ç–æ–∫ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞                        |
| **Message Brokers (Redis, Kafka)** | –û—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏                      |

![alt text](img/Server-Sent-Events.gif)


![alt text](img/Message_Brokers.gif)

### **1.3 –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è**

- –ß–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –¢–æ—Ä–≥–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- IoT-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---
![alt text](img/scaling.jpg)


![alt text](img/scaling-2.png)

## **2. –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç-API**

### **2.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

```bash
pip install fastapi uvicorn websockets redis python-socketio
```

### **2.2 WebSocket-—Å–µ—Ä–≤–µ—Ä –Ω–∞ FastAPI**

–§–∞–π–ª `main.py`:

```python
from fastapi import FastAPI, WebSocket, WebSocketDisconnect
from fastapi.middleware.cors import CORSMiddleware
import redis
import json

app = FastAPI()

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis –¥–ª—è pub/sub
r = redis.Redis(host='localhost', port=6379, decode_responses=True)

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
active_connections = set()

@app.websocket("/ws/{user_id}")
async def websocket_endpoint(websocket: WebSocket, user_id: str):
    await websocket.accept()
    active_connections.add(websocket)
    pubsub = r.pubsub()
    pubsub.subscribe("chat_channel")  # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∫–∞–Ω–∞–ª

    try:
        while True:
            # –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
            data = await websocket.receive_text()
            message = {"user_id": user_id, "text": data}
  
            # –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Redis
            r.publish("chat_channel", json.dumps(message))
  
    except WebSocketDisconnect:
        active_connections.remove(websocket)
        pubsub.unsubscribe("chat_channel")

# –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
@app.on_event("startup")
async def startup_event():
    import asyncio
    asyncio.create_task(event_listener())

async def event_listener():
    pubsub = r.pubsub()
    pubsub.subscribe("chat_channel")
  
    for message in pubsub.listen():
        if message["type"] == "message":
            data = json.loads(message["data"])
            # –†–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º
            for connection in active_connections.copy():
                try:
                    await connection.send_text(f"User {data['user_id']}: {data['text']}")
                except:
                    active_connections.remove(connection)
```

### **2.3 –ö–ª–∏–µ–Ω—Ç –Ω–∞ JavaScript (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)**

–§–∞–π–ª `static/index.html`:

```html
<!DOCTYPE html>
<html>
<body>
  <input id="message" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ">
  <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  <div id="chat"></div>

  <script>
    const ws = new WebSocket("ws://localhost:8000/ws/user123");
  
    ws.onmessage = (event) => {
      document.getElementById("chat").innerHTML += `<p>${event.data}</p>`;
    };

    function sendMessage() {
      const message = document.getElementById("message").value;
      ws.send(message);
    }
  </script>
</body>
</html>
```

---

## **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   uvicorn main:app --reload
   ```
2. –û—Ç–∫—Ä–æ–π—Ç–µ `static/index.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤—Ç–æ—Ä—É—é –≤–∫–ª–∞–¥–∫—É —Å —Ç–µ–º –∂–µ —Ñ–∞–π–ª–æ–º –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —É –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

---

## **4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **4.1 –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

- **Publisher/Subscriber (Pub/Sub):**
  ```python
  r.publish("channel", "data")  # –û—Ç–ø—Ä–∞–≤–∫–∞
  r.subscribe("channel")        # –ü–æ–ª—É—á–µ–Ω–∏–µ
  ```
- **Event Sourcing:** –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è.

### **4.2 –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Nginx** –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏.
- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ **Kafka** –∏–ª–∏ **RabbitMQ** –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π.

---

## **5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è**

1. **–î–æ–±–∞–≤—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é** (JWT –¥–ª—è WebSocket).
2. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–º–Ω–∞—Ç—ã —á–∞—Ç–∞** (—Ä–∞–∑–¥–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –≤ Redis).
3. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π.

---

## **6. –ò—Ç–æ–≥–∏**

- **Event-based API** –∏–¥–µ–∞–ª—å–Ω—ã –¥–ª—è —Å–∏—Å—Ç–µ–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
- **WebSockets + Redis** ‚Äì –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —á–∞—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
- **–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Kafka/RabbitMQ.

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**

- [FastAPI WebSockets](https://fastapi.tiangolo.com/advanced/websockets/)
- [Redis Pub/Sub](https://redis.io/topics/pubsub)

üöÄ –í—ã —Å–æ–∑–¥–∞–ª–∏ —Å–æ–±—ã—Ç–∏–π–Ω–æ–µ API –Ω–∞ Python.
