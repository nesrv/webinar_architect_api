# –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ Webhook vs Polling –¥–ª—è Telegram Bot

## –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**Webhook (ex-3-telegram-webhook)** - Telegram —Å–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä  
**Polling (ex-3-telegram-polling)** - –í–∞—à —Å–µ—Ä–≤–µ—Ä —Å–∞–º —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É Telegram –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

## –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∞–ª–æ–≥–∏—è

**Webhook** = –ü–æ—á—Ç–∞–ª—å–æ–Ω –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø–∏—Å—å–º–∞ –∫ –≤–∞–º –¥–æ–º–æ–π  
**Polling** = –í—ã —Å–∞–º–∏ —Ö–æ–¥–∏—Ç–µ –Ω–∞ –ø–æ—á—Ç—É –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–∏—Å—å–º–∞

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Webhook

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: –í—ã –≥–æ–≤–æ—Ä–∏—Ç–µ Telegram: "–ü—Ä–∏—Å—ã–ª–∞–π —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ https://mybot.com/webhook"
2. **–û–∂–∏–¥–∞–Ω–∏–µ**: –í–∞—à —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –Ω–∞ endpoint `/webhook`
3. **–ü–æ–ª—É—á–µ–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –±–æ—Ç—É ‚Üí Telegram –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à URL
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –í–∞—à —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
5. **–û—Ç–≤–µ—Ç**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ `{"ok": true}` —á—Ç–æ–±—ã Telegram –∑–Ω–∞–ª —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram ‚Üí [POST /webhook] ‚Üí –í–∞—à —Å–µ—Ä–≤–µ—Ä
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **HTTPS –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** (Telegram –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å HTTP)
- **–ü—É–±–ª–∏—á–Ω—ã–π IP** –∏–ª–∏ –¥–æ–º–µ–Ω
- **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç** (–¥–æ 60 —Å–µ–∫, –∏–Ω–∞—á–µ Telegram –ø–æ–≤—Ç–æ—Ä–∏—Ç –∑–∞–ø—Ä–æ—Å)
- **–í–∞–ª–∏–¥–Ω—ã–π SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**

### –ö–æ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```python
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º webhook
POST https://api.telegram.org/bot{TOKEN}/setWebhook
{"url": "https://mybot.com/webhook"}

# –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
@app.post("/webhook")
async def webhook(update: dict):
    # Telegram –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Å—é–¥–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    return {"ok": True}
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Polling

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:
1. **–ó–∞–ø—É—Å–∫**: –í–∞—à —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
2. **–ó–∞–ø—Ä–æ—Å**: –ö–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É Telegram: "–ï—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è?"
3. **–ü–æ–ª—É—á–µ–Ω–∏–µ**: Telegram –æ—Ç–≤–µ—á–∞–µ—Ç —Å–ø–∏—Å–∫–æ–º –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∏–ª–∏ –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º)
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
5. **–ü–æ–≤—Ç–æ—Ä**: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –ø–æ—Ä—Ü–∏—é —Å –Ω–æ–≤—ã–º offset

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
```
–í–∞—à —Å–µ—Ä–≤–µ—Ä ‚Üí [GET /getUpdates] ‚Üí Telegram ‚Üí –û—Ç–≤–µ—Ç ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –ü–æ–≤—Ç–æ—Ä
```

### Long Polling:
- **timeout=30** - –∂–¥–µ–º –¥–æ 30 —Å–µ–∫ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
- **offset** - ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ï—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ä–∞–∑—É
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∂–¥–µ—Ç 30 —Å–µ–∫, –ø–æ—Ç–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç

### –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
```python
async def polling():
    offset = 0
    while True:
        # –°–ø—Ä–∞—à–∏–≤–∞–µ–º —É Telegram
        response = await client.get(
            f"{API}/getUpdates",
            params={"offset": offset, "timeout": 30}
        )
        
        for update in response.json()["result"]:
            offset = update["update_id"] + 1
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Webhook | Polling |
|----------|---------|---------|
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∞** | –°–ª–æ–∂–Ω–∞—è (–Ω—É–∂–µ–Ω HTTPS) | –ü—Ä–æ—Å—Ç–∞—è |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è | –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 30 —Å–µ–∫ |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | –ú–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è | –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ |
| **–†–µ—Å—É—Ä—Å—ã** | –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ | –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã |
| **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è** | HTTPS, –ø—É–±–ª–∏—á–Ω—ã–π IP | –õ—é–±–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ |

## –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**Webhook:**
- ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (0-100–º—Å)
- üìâ –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö)
- üîÑ –ù–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**Polling:**
- ‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 30 —Å–µ–∫
- üìà –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–∑–∞–ø—Ä–æ—Å—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- üîó –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Telegram

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

**Webhook:**
- ‚ùå –ú–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö —Å–µ—Ä–≤–µ—Ä–∞
- üîÑ Telegram –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞—Ç—å (timeout 60 —Å–µ–∫)

**Polling:**
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (offset —Å–∏—Å—Ç–µ–º–∞)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- ‚è∞ –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**Webhook:**
- üë• –û—Ç–ª–∏—á–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- üñ•Ô∏è –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å load balancer
- üìä –õ–µ–≥–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ HTTP –º–µ—Ç—Ä–∏–∫–∏

**Polling:**
- üë§ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –±–æ—Ç–æ–≤
- üñ•Ô∏è –°–ª–æ–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å (–æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å)
- üìä –°–ª–æ–∂–Ω–µ–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### Webhook —Å—Ü–µ–Ω–∞—Ä–∏–π:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–∏–≤–µ—Ç" ‚Üí Telegram
2. Telegram ‚Üí POST /webhook {"message": {"text": "–ü—Ä–∏–≤–µ—Ç"}}
3. –í–∞—à —Å–µ—Ä–≤–µ—Ä: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ 50–º—Å
4. –û—Ç–≤–µ—Ç: {"ok": true}
5. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### Polling —Å—Ü–µ–Ω–∞—Ä–∏–π:
```
1. –°–µ—Ä–≤–µ—Ä: GET /getUpdates?offset=0&timeout=30
2. Telegram: [] (–ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç, –∂–¥–µ–º 30 —Å–µ–∫)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç "–ü—Ä–∏–≤–µ—Ç"
4. –°–µ—Ä–≤–µ—Ä: GET /getUpdates?offset=0&timeout=30
5. Telegram: [{"update_id": 1, "message": {"text": "–ü—Ä–∏–≤–µ—Ç"}}]
6. –û–±—Ä–∞–±–æ—Ç–∫–∞, offset = 2
7. –ü–æ–≤—Ç–æ—Ä —Å offset=2
```

## –û—Ç–ª–∞–¥–∫–∞ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Webhook:
- üîß –ù—É–∂–µ–Ω ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- üìù –õ–æ–≥–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

### Polling:
- üîß –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- üìù –ü—Ä–æ—Å—Ç—ã–µ print() –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

### Webhook - –≤—ã–±–∏—Ä–∞–π—Ç–µ –µ—Å–ª–∏:
- ‚úÖ –£ –≤–∞—Å –µ—Å—Ç—å HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- ‚úÖ –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ –ü—Ä–æ–¥–∞–∫—à–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### Polling - –≤—ã–±–∏—Ä–∞–π—Ç–µ –µ—Å–ª–∏:
- ‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç–µ –∑–∞ NAT/firewall
- ‚úÖ –ù–µ—Ç HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

**–ù–∞—á–Ω–∏—Ç–µ —Å Polling** (ex-3-telegram-polling) –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –ü—Ä–æ—â–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å (–ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å)
- –†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ (–¥–∞–∂–µ –∑–∞ NAT)
- –ù–µ –Ω—É–∂–µ–Ω HTTPS
- –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
- –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

**–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ Webhook** (ex-3-telegram-webhook) –∫–æ–≥–¥–∞:
- –û—Å–≤–æ–∏—Ç–µ –æ—Å–Ω–æ–≤—ã Telegram API
- –ü–æ–ª—É—á–∏—Ç–µ HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –î–µ–ø–ª–æ–∏—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

## –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ –º–µ—Ç–æ–¥–∞:
- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: Polling –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ü—Ä–æ–¥–∞–∫—à–Ω**: Webhook –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**: –û–¥–∏–Ω –∫–æ–¥, —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π